name: Check and Run news.yml

on:
  workflow_dispatch:
  schedule:
    - cron: '0 * * * *' # Runs every hour

jobs:
  stop-and-run-news:
    runs_on: ubuntu-latest
    steps:
      - name: Check for running workflows
        id: check
        uses: styfle/cancel-workflow-action@0.9.1
        with:
          access_token: ${{ github.token }}
          workflow_id: news.yml

      - name: Wait for workflows to finish
        run: |
          while [ "${{ steps.check.outputs.running_workflows }}" != "0" ]; do
            echo 'Waiting for other workflows to finish...'
            sleep 15
            # Recheck the number of running workflows
            echo 'Rechecking running workflows...'
            steps:
            - id: recheck
              uses: styfle/cancel-workflow-action@0.9.1
              with:
                access_token: ${{ github.token }}
                workflow_id: news.yml
          done

      - name: Trigger new news.yml workflow
        uses: benc-uk/workflow-dispatch@v1
        with:
          workflow: news.yml
          token: ${{ secrets.GITHUB_TOKEN }}
